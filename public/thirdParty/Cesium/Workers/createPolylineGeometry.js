define(["./when-208fe5b0","./Cartesian2-8417ca3d","./ArcType-dc1c5aee","./arrayRemoveDuplicates-0f62a181","./Transforms-a73b3b3b","./Color-b0d12252","./ComponentDatatype-9204e9f6","./Check-d18af7c4","./GeometryAttribute-04a19cfe","./GeometryAttributes-b0b294d8","./IndexDatatype-d47ad6f6","./Math-4e53b694","./PolylinePipeline-6c0541b0","./VertexFormat-e8cbf5b3","./RuntimeError-7f634f5d","./WebGLConstants-76bb35d1","./EllipsoidGeodesic-691360b8","./EllipsoidRhumbLine-8cb2e5a4","./IntersectionTests-7d224a2f","./Plane-4aa8974d"],function(z,J,j,K,Q,X,Z,e,$,ee,te,re,ae,m,t,r,a,o,n,i){"use strict";var oe=[];function f(e){var t=(e=z.defaultValue(e,z.defaultValue.EMPTY_OBJECT)).positions,r=e.colors,a=z.defaultValue(e.width,1),o=z.defaultValue(e.colorsPerVertex,!1);this._useDistanceST=z.defaultValue(e.useDistanceST,!1),this._positions=t,this._colors=r,this._width=a,this._colorsPerVertex=o,this._vertexFormat=m.VertexFormat.clone(z.defaultValue(e.vertexFormat,m.VertexFormat.DEFAULT)),this._arcType=z.defaultValue(e.arcType,j.ArcType.GEODESIC),this._granularity=z.defaultValue(e.granularity,re.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=J.Ellipsoid.clone(z.defaultValue(e.ellipsoid,J.Ellipsoid.WGS84)),this._workerName="createPolylineGeometry";t=1+t.length*J.Cartesian3.packedLength;t+=z.defined(r)?1+r.length*X.Color.packedLength:1,this.packedLength=t+J.Ellipsoid.packedLength+m.VertexFormat.packedLength+5}f.pack=function(e,t,r){var a;r=z.defaultValue(r,0);var o=e._positions,n=o.length;for(t[r++]=n,a=0;a<n;++a,r+=J.Cartesian3.packedLength)J.Cartesian3.pack(o[a],t,r);var i=e._colors,n=z.defined(i)?i.length:0;for(t[r++]=n,a=0;a<n;++a,r+=X.Color.packedLength)X.Color.pack(i[a],t,r);return J.Ellipsoid.pack(e._ellipsoid,t,r),r+=J.Ellipsoid.packedLength,m.VertexFormat.pack(e._vertexFormat,t,r),r+=m.VertexFormat.packedLength,t[r++]=e._width,t[r++]=e._colorsPerVertex?1:0,t[r++]=e._arcType,t[r++]=e._granularity,t[r]=e._useDistanceST,t};var h=J.Ellipsoid.clone(J.Ellipsoid.UNIT_SPHERE),C=new m.VertexFormat,v={positions:void 0,colors:void 0,ellipsoid:h,vertexFormat:C,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0,useDistanceST:!1};f.unpack=function(e,t,r){t=z.defaultValue(t,0);for(var a=e[t++],o=new Array(a),n=0;n<a;++n,t+=J.Cartesian3.packedLength)o[n]=J.Cartesian3.unpack(e,t);var i=0<(a=e[t++])?new Array(a):void 0;for(n=0;n<a;++n,t+=X.Color.packedLength)i[n]=X.Color.unpack(e,t);var l=J.Ellipsoid.unpack(e,t,h);t+=J.Ellipsoid.packedLength;var s=m.VertexFormat.unpack(e,t,C);t+=m.VertexFormat.packedLength;var p=e[t++],c=1===e[t++],d=e[t++],u=e[t++],y=e[t];return z.defined(r)?(r._positions=o,r._colors=i,r._ellipsoid=J.Ellipsoid.clone(l,r._ellipsoid),r._vertexFormat=m.VertexFormat.clone(s,r._vertexFormat),r._width=p,r._colorsPerVertex=c,r._arcType=d,r._granularity=u,r._useDistanceST=y,r):(v.positions=o,v.colors=i,v.width=p,v.colorsPerVertex=c,v.arcType=d,v.granularity=u,v.useDistanceST=y,new f(v))};var ne=new J.Cartesian3,ie=new J.Cartesian3,le=new J.Cartesian3,se=new J.Cartesian3;return f.createGeometry=function(e){var t=e._width,r=e._vertexFormat,a=e._colors,o=e._colorsPerVertex,n=e._arcType,i=e._granularity,l=e._ellipsoid,s=K.arrayRemoveDuplicates(e._positions,J.Cartesian3.equalsEpsilon);if(!((T=s.length)<2||t<=0)){if(n===j.ArcType.GEODESIC||n===j.ArcType.RHUMB){var p,c=n===j.ArcType.GEODESIC?(p=re.CesiumMath.chordLength(i,l.maximumRadius),ae.PolylinePipeline.numberOfPoints):(p=i,ae.PolylinePipeline.numberOfPointsRhumbLine),d=ae.PolylinePipeline.extractHeights(s,l);if(z.defined(a)){for(var u=1,y=0;y<T-1;++y)u+=c(s[y],s[y+1],p);var m=new Array(u),f=0;for(y=0;y<T-1;++y){var h=s[y],C=s[y+1],v=a[y],_=c(h,C,p);if(o&&y<u)for(var b=function(e,t,r){var a=oe;a.length=r;var o=e.red,n=e.green,i=e.blue,l=e.alpha,s=t.red,p=t.green,c=t.blue,d=t.alpha;if(X.Color.equals(e,t)){for(h=0;h<r;h++)a[h]=X.Color.clone(e);return a}for(var u=(s-o)/r,y=(p-n)/r,m=(c-i)/r,f=(d-l)/r,h=0;h<r;h++)a[h]=new X.Color(o+h*u,n+h*y,i+h*m,l+h*f);return a}(v,a[y+1],_),g=b.length,A=0;A<g;++A)m[f++]=b[A];else for(A=0;A<_;++A)m[f++]=X.Color.clone(v)}m[f]=X.Color.clone(a[a.length-1]),a=m,oe.length=0}s=n===j.ArcType.GEODESIC?ae.PolylinePipeline.generateCartesianArc({positions:s,minDistance:p,ellipsoid:l,height:d}):ae.PolylinePipeline.generateCartesianRhumbArc({positions:s,granularity:p,ellipsoid:l,height:d})}var T,E,D,P,l=4*(T=s.length)-4,w=new Float64Array(3*l),x=new Float64Array(3*l),k=new Float64Array(3*l),V=new Float32Array(2*l),L=r.st?new Float32Array(2*l):void 0,F=z.defined(a)?new Uint8Array(4*l):void 0,G=0,S=0,O=0,R=0,I=[],B=0;if(e._useDistanceST)for(I.push(0),A=1;A<T;++A)B+=J.Cartesian3.distance(s[A-1],s[A]),I.push(B);for(A=0;A<T;++A){0===A?(E=ne,J.Cartesian3.subtract(s[0],s[1],E),J.Cartesian3.add(s[0],E,E)):E=s[A-1],J.Cartesian3.clone(E,le),J.Cartesian3.clone(s[A],ie),A===T-1?(E=ne,J.Cartesian3.subtract(s[T-1],s[T-2],E),J.Cartesian3.add(s[T-1],E,E)):E=s[A+1],J.Cartesian3.clone(E,se),z.defined(F)&&(D=0===A||o?a[A]:a[A-1],A!==T-1&&(P=a[A]));for(var U=A===T-1?2:4,N=0===A?2:0;N<U;++N){J.Cartesian3.pack(ie,w,G),J.Cartesian3.pack(le,x,G),J.Cartesian3.pack(se,k,G),G+=3;var M=N-2<0?-1:1;V[S++]=N%2*2-1,V[S++]=M*t,r.st&&(e._useDistanceST?L[O++]=I[A]/B:L[O++]=A/(T-1),L[O++]=Math.max(V[S-2],0)),z.defined(F)&&(M=N<2?D:P,F[R++]=X.Color.floatToByte(M.red),F[R++]=X.Color.floatToByte(M.green),F[R++]=X.Color.floatToByte(M.blue),F[R++]=X.Color.floatToByte(M.alpha))}}d=new ee.GeometryAttributes;d.position=new $.GeometryAttribute({componentDatatype:Z.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:w}),d.prevPosition=new $.GeometryAttribute({componentDatatype:Z.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:x}),d.nextPosition=new $.GeometryAttribute({componentDatatype:Z.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:k}),d.expandAndWidth=new $.GeometryAttribute({componentDatatype:Z.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V}),r.st&&(d.st=new $.GeometryAttribute({componentDatatype:Z.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L})),z.defined(F)&&(d.color=new $.GeometryAttribute({componentDatatype:Z.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:F,normalize:!0}));var H=te.IndexDatatype.createTypedArray(l,6*T-6),W=0,Y=0,q=T-1;for(A=0;A<q;++A)H[Y++]=W,H[Y++]=W+2,H[Y++]=W+1,H[Y++]=W+1,H[Y++]=W+2,H[Y++]=W+3,W+=4;return new $.Geometry({attributes:d,indices:H,primitiveType:$.PrimitiveType.TRIANGLES,boundingSphere:Q.BoundingSphere.fromPoints(s),geometryType:$.GeometryType.POLYLINES})}},function(e,t){return(e=z.defined(t)?f.unpack(e,t):e)._ellipsoid=J.Ellipsoid.clone(e._ellipsoid),f.createGeometry(e)}});
